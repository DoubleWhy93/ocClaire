# Playground Type 2: Board Game / DND-Style Interactive

## Overview

A structured, rules-based interactive mode where characters participate in a tabletop RPG-style scenario. An AI "Game Master" (GM) manages the rules, resolves actions, and narrates outcomes while characters respond in-character.

## Core Concepts

### Game Master (GM)
- A dedicated AI agent (not a character) that:
  - Narrates the scene and describes outcomes
  - Resolves character actions using dice/skill checks
  - Manages turn order and game state
  - Enforces rules and maintains consistency
- Uses a specialized system prompt with game rules embedded

### Character Sheets
Each participating character has stats derived from their traits:
- **Strength / Agility / Intelligence / Charisma / Willpower** — auto-generated from character traits and species
- **Skills** — derived from character role and background
- **HP / Stamina** — resource pools that deplete during the game

### Turn Structure
1. **GM Narration** — Describes the current situation
2. **Character Actions** — Each character declares an action (AI-generated based on personality)
3. **Resolution** — GM rolls virtual dice, applies modifiers, describes outcomes
4. **State Update** — HP, inventory, and position changes applied
5. **User Override** — User can veto or modify any character's action before resolution

## Architecture

### State Management
```typescript
interface GameState {
  scene: string;
  round: number;
  characters: CharacterGameState[];
  log: GameEvent[];
  inventory: Record<string, string[]>;
}

interface CharacterGameState {
  id: string;
  hp: number;
  maxHp: number;
  stamina: number;
  stats: Record<string, number>;
  conditions: string[]; // poisoned, stunned, etc.
  position: string;
}

interface GameEvent {
  type: 'narration' | 'action' | 'roll' | 'result' | 'user';
  speaker: string;
  content: string;
  rollResult?: { dice: string; value: number; modifier: number; total: number };
}
```

### GM System Prompt Template
```
You are the Game Master for a tabletop RPG session. Your role:
1. Narrate scenes vividly but concisely
2. When a character attempts an action, determine the appropriate skill check
3. Use the dice result provided to determine success/failure
4. Describe outcomes that respect character personalities and abilities
5. Maintain dramatic tension and fair challenge

Current Scene: {scene}
Active Characters: {characterSummaries}
Round: {round}

Rules:
- Skill checks: d20 + modifier. DC 10 = easy, DC 15 = medium, DC 20 = hard
- Combat: d20 + relevant stat for attack, damage = weapon die + stat modifier
- Characters can cooperate for advantage (+5 bonus)
```

### Dice System
- Virtual dice rolled client-side using `Math.random()`
- Results passed to GM as context, not generated by AI (prevents bias)
- Displayed in UI with animation

### UI Components

#### `GameBoard.tsx`
- Split layout: left sidebar (character sheets), main area (narrative + actions)
- Character portraits with HP bars and condition icons
- Action log with collapsible dice roll details

#### `ActionSelector.tsx`
- After GM narration, shows each character's AI-suggested action
- User can:
  - Accept the suggested action
  - Edit the action text
  - Choose from preset action types (Attack, Defend, Use Skill, Use Item, Talk)
  - Skip a character's turn

#### `DiceRoller.tsx`
- Visual dice rolling animation
- Shows roll breakdown: `d20(14) + STR(3) = 17 vs DC 15 ✓`

#### `CharacterSheet.tsx`
- Expandable panel showing full stats, skills, conditions, inventory
- Real-time updates as game progresses

### Scenario Templates
Pre-built scenarios to help users get started:
1. **Dungeon Crawl** — Explore a mysterious underground ruin
2. **Social Intrigue** — Navigate a political gathering
3. **Survival** — Stranded in hostile environment
4. **Mystery** — Investigate a crime or supernatural event
5. **Custom** — User writes their own scenario

## Implementation Phases

### Phase 1: Core Loop
- GM narration + character action generation + dice resolution
- Basic stat system derived from character traits
- Simple text-based log view

### Phase 2: Enhanced UI
- Character sheet sidebar
- Dice rolling animation
- Action editing/override

### Phase 3: Persistence & Polish
- Save/load game state to localStorage
- Scenario templates
- Battle maps (optional stretch goal)

## API Considerations
- GM uses more tokens per turn (needs scene context + rules + all character states)
- Recommend `maxTokens: 2048` for GM
- Character action declarations can be shorter (`maxTokens: 512`)
- Estimated ~4-6 API calls per round (1 GM + 1 per character for action + 1 GM for resolution)
- Context window management critical — summarize older events

## Open Questions
- Should users be able to play AS one of the characters (hybrid mode)?
- How to handle character death / elimination?
- Should the GM track a "difficulty curve" that adapts to player engagement?
- Integration with existing character prompts vs. separate game-mode prompts?
