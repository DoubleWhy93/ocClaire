---
import BaseLayout from '../../layouts/BaseLayout.astro';
import FictionCard from '../../components/FictionCard.astro';
import { getCollection } from 'astro:content';

const allFiction = await getCollection('fiction');
const novels = allFiction
  .filter((f) => f.data.type === 'novel-meta')
  .sort((a, b) => a.data.order - b.data.order);

const worlds = await getCollection('worlds');
const worldNames: Record<string, string> = {};
for (const w of worlds) {
  worldNames[w.id] = w.data.name;
}
---

<BaseLayout title="Fiction â€” OC Showcase">
  <section class="max-w-6xl mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold text-slate-100 mb-2">Fiction</h1>
    <p class="text-slate-400 mb-8">Stories from the worlds we've built.</p>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {novels.map((novel) => {
        if (novel.data.type !== 'novel-meta') return null;
        return (
          <FictionCard
            id={novel.id}
            novelTitle={novel.data.novelTitle}
            synopsis={novel.data.synopsis}
            world={worldNames[novel.data.world] || novel.data.world}
            status={novel.data.status}
            cover={novel.data.cover}
          />
        );
      })}
    </div>
  </section>
</BaseLayout>
